---
title: "Relat√≥rios reprodut√≠veis com R"
subtitle: 'Curso de Ver√£o IME-USP 2022' 
author: 
  - "<h3>Ministrante: <br> Beatriz Milz</h3>"
  - "<h3>Monitoria: <br> Ana Carolina Moreno <br> Tereza Lacerda <br> Alan da Silva <br> Julia Cansado</h3>"
#date: 'Fevereiro 2022'
output:
  xaringan::moon_reader:
    css: [xaringan-themer.css, custom.css]
    nature:
      slideNumberFormat: "<a href='https://beatrizmilz.github.io/2022-curso-de-verao-ime-usp-relatorios/'><i class='fas fa-external-link-alt'></i> P√°gina do curso</a> - <a href='#sumario'>Guia</a> - %current%/%total%"
      titleSlideClass: ["title-slide", "rascunho"]
      highlightStyle: github
      highlightLines: true
      ratio: '16:9'
      countIncrementalSlides: true
# rmarkdown::render(input = "docs/slides/index.Rmd")  

---

```{r setup, include=FALSE}
options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(
  fig.width=9, fig.height=3.5, fig.retina=3,
  fig.align = "center",
  out.width = "100%",
  cache = FALSE,
  echo = FALSE,
  message = FALSE, 
  warning = FALSE,
  hiline = TRUE
)
```

```{r xaringan-themer, include=FALSE, warning=FALSE}
library(xaringanthemer)
style_duo_accent(
  primary_color = "#1094AB",
  title_slide_background_color = "#ffffff",
  title_slide_text_color = "#1094AB",
  inverse_text_color = "#826b37",
  inverse_header_color = "#FDB525",
  inverse_background_color = "#f2f2f2",
  secondary_color = "#FDB525",
  background_color = "#FFFFFF",
  code_inline_background_color = "#faf0f4",
 
  
  header_font_google = google_font("Quicksand"),
  text_font_google   = google_font("Work Sans", "300", "300i"),
  code_font_google   = google_font("Fira Code"),
  base_font_size = "27px",
  extra_css = list(".remark-code-line" = list("background-color" = "#f2f2f2"))
)

```

```{r xaringanExtra-clipboard, echo=FALSE}
xaringanExtra::use_clipboard()
```


```{r, include=FALSE}
ref_pacotes_curso_r <- function(){
  cat('.topnote[<i class="far fa-flag"></i> [Slide](https://curso-r.github.io/main-pacotes/slides/index.html) adaptado do curso de [Pacotes](https://curso-r.com/cursos/pacotes/), da [Curso-R](https://curso-r.com/).]')
}

ref_relatorios_curso_r <- function(){
  cat('.topnote[<i class="far fa-flag"></i> Slide adaptado do curso de [Relat√≥rios](https://loja.curso-r.com/relatorios-e-apresentacoes-automaticas.html), da [Curso-R](https://curso-r.com/).]')
}
```


## Ministrantes e monitoria

```{r echo=FALSE, results='asis'}
# googlesheets4::gs4_auth()
# sheet_profs <- googlesheets4::read_sheet("1CN9PmWmNa4CEM9HI5jgYqHSK48K92n--BZWXglH5NVE", sheet = "info-profs")
# 
# readr::write_rds(x = sheet_profs, "data/sheet_profs.Rds")

sheet_profs <- readr::read_rds("data/sheet_profs.Rds")

profs <- sheet_profs |> 
  dplyr::mutate(texto = glue::glue("- **{nome}** {
mini_bio
} <br><br>"))

profs |>
  dplyr::slice(1:3) |>
  dplyr::pull(texto)

```

---

## Ministrantes e monitoria


```{r echo=FALSE, results='asis'}
profs |>
  dplyr::slice(4:5) |>
  dplyr::pull(texto)
```

---

## Curso sobre R no Programa de Ver√£o IME/USP

- De 2015 √† 2017, um grupo de alunos do IME/USP ofereceu um curso sobre R que apresentava temas de introdut√≥rios at√© intermedi√°rio/avan√ßado. 
  - Material de 2016: https://curso-r.github.io/verao2016/
  - Material de 2017: https://curso-r.github.io/verao2017/
  - Em 2018 este grupo criou a Curso-R: https://curso-r.com/


- Nath√°lia Dem√©trio come√ßou a ministrar  o curso de 'Introdu√ß√£o √† Programa√ß√£o em R'.

- Em 2022, os cursos de 'Princ√≠pios de Visualiza√ß√£o de Dados com R' e 'Relat√≥rios Reprodut√≠veis com R' foram adicionados ao Programa de Ver√£o IME/USP.

---

.pull-left[

## R-Ladies


- R-Ladies √© uma organiza√ß√£o mundial cuja miss√£o √© promover a diversidade de g√™nero na comunidade da linguagem R.



- P√∫blico-alvo s√£o as pessoas que se identificam com g√™neros sub-representados na comunidade R, portanto: mulheres cis, mulheres trans, homens trans, pessoas n√£o-bin√°rias e queer.

- Links: https://linktr.ee/rladies_sp


]

.pull-right[

<br>

<center><img src= 'https://beatrizmilz.github.io/slidesR/rladies/img/allisonhorst/community1.jpg' width = '90%' alt='Author: Allison Horst'></br><p>Ilustra√ß√£o por <a href='https://twitter.com/allison_horst' target=_blank>@allison_horst</a></p></center>



]




---
name: sumario

## Guia

- [Sobre o curso](#sobre-o-curso)

- [Introdu√ß√£o ao conceito de reprodutibilidade](#reprodutibilidade)


- [RMarkdown](#rmarkdown)

- [Git e GitHub](#git-e-github)


---
name: sobre-o-curso
class: middle, center, inverse

## Sobre o curso

---

### Objetivos de aprendizagem

Que voc√™s saibam ao final do curso:

- No√ß√µes de reprodutibilidade

- Como criar documentos usando RMarkdown.

- Como exportar esses documentos em word, PDF e HTML.

- Como controlar as vers√µes do documento usando o Git e GitHub.

- Como disponibilizar o documento na internet. 

---

### Din√¢minca de aula

- S√£o 5 aulas: 

  - Aulas 1 e 2: conceito de reprodutibilidade, usar projetos em R e introdu√ß√£o ao pacote RMarkdown.
  
  - Aulas 3 e 4: introdu√ß√£o ao Git e GitHub no RStudio.
  
  - Aula 5: exemplo para praticar os conte√∫dos das aulas anteriores.
  

- Pratique depois da aula! Dica: [Podcast Naruhodo: Powerpoint √© √∫til para a aprendizagem?](https://www.b9.com.br/shows/naruhodo/naruhodo-205-powerpoint-e-util-para-a-aprendizagem/)

---

### Informa√ß√µes gerais

- Grava√ß√£o das aulas: caso n√£o queira aparecer na grava√ß√£o, mantenha sua c√¢mera fechada.

- D√∫vidas:

  - Durante as aulas: enviem d√∫vidas no chat.

  - Fora do hor√°rio de aulas:
      - Durante o oferecimento do curso: [na plataforma USP Extens√£o](https://cursosextensao.usp.br/)
      - Ap√≥s a finaliza√ß√£o do curso: [F√≥rum da Curso-R](https://discourse.curso-r.com/)


---

### Requisitos para o certificado

- Ter frequ√™ncia igual ou superior √† 75% (ou seja, pode ter 1 falta).

- [TO DO: preencher depois sobre os exerc√≠cios e trabalho final]



---

### Check-list


- Instalar:
  - [R](https://livro.curso-r.com/1-1-instalacao-do-r.html)
  - [RStudio](https://livro.curso-r.com/1-1-instalacao-do-r.html) 
  - [Git](https://git-scm.com/)

- [Criar uma conta no GitHub](https://github.com/)

---

### Check-list de pacotes

- Instalar pacotes necess√°rios:

```r
pacotes_necessarios <- c("usethis",
                         "rmarkdown",
                         "knitr",
                         "pagedown",
                         "xaringan",
                         "readr")

install.packages(pacotes_necessarios)
```


---

### Guia dos slides

- As cores da linha vertical indicam o tipo de conte√∫do dos slides!

  - Cinza: conte√∫do te√≥rico, expositivo.
  
  - Azul: demonstra√ß√£o, mostraremos como √© feito no RStudio.
  
  - Amarelo: voc√™s fazem exerc√≠cios para praticar o que foi apresentado.
  
  - Coral: pontos principais para revis√£o te√≥rica.

---
name: reprodutibilidade
class: middle, center, inverse

## Introdu√ß√£o ao conceito de reprodutibilidade

.left[
- O que vamos aprender:

  - O que √© reprodutibilidade?

  - O que s√£o projetos no RStudio, e qual √© a import√¢ncia de us√°-los? 

  - O que s√£o caminhos relativos e absolutos?

  - Como desabilitar a funcionalidade do RStudio que armazena automaticamente os objetos e o hist√≥rico?
]

---
class: teoria

.pull-left[
### Reprodutibilidade

- "√â um conceito que n√£o tem uma defini√ß√£o √∫nica e comum". [(Gundersen, 2021)](https://doi.org/10.1098/rsta.2020.0210)

- "Para algu√©m fazer uma afirma√ß√£o cient√≠fica leg√≠tima, ele deve ser capaz de reproduzir totalmente seus resultados a partir de seus dados brutos (e de prefer√™ncia outros devem ser capazes de reproduzi-los tamb√©m)". [Dr. John Paul Helveston](https://jhelvy.github.io/r4aPrimer/L6-reproducible-reporting.html)

 
]

--

.pull-right[

Quais fatores contribuem com  pesquisa n√£o reprodut√≠vel? Fonte: <a href='https://doi.org/10.1038/533452a'>Baker (2016)</a>

```{r echo=FALSE, out.width="100%"}
knitr::include_graphics("img/irreproducible.png")
```


]



---
class: teoria

.pull-left[

### Reprodutibilidade


> ‚ÄúReprodutibilidade √© como escovar os dentes. Isso √© bom para voc√™, mas leva tempo e esfor√ßo. Depois de aprender, torna-se um h√°bito.‚Äù - Irakli Loladze, Bryan College of Health Sciences em Lincoln, Nebraska.  
  > .small[Baker, M. 1,500 scientists lift the lid on reproducibility. Nature 533, 452‚Äì454 (2016). https://doi.org/10.1038/533452a]

]

--

.pull-right[
- Exemplos:

  - Boas pr√°ticas, como: n√£o usar caracteres especiais nos caminhos, vari√°veis, nomes de coluna, etc; armazenar os arquivos de forma consistente.

  - Registrar a vers√£o do R e dos pacotes utilizados
  
  - Documentar a an√°lise
  
  - Controlar a vers√£o dos arquivos
]

???

Outras refer√™ncias interessantes:

- [Introduction to bioinformatics -  Chapter 8 Reproducible research, - Laurent Gatto](https://uclouvain-cbio.github.io/WSBIM1207/sec-rr.html)



---
class:  teoria

### Projetos do RStudio

.pull-left[

- O RStudio permite a cria√ß√£o de Projetos.


- O projeto √© uma pasta no computador, onde devemos armazenar todos os arquivos usados ou criados em uma an√°lise. Essa pasta ir√° conter tamb√©m um arquivo com o nome do projeto e a extens√£o `.Rproj`.

- Para cada an√°lise, lembre-se de criar um `.Rproj` correspondente.



]

.pull-right[

- Usar projetos no RStudio facilita a organiza√ß√£o dos arquivos, posteriormente sincronizar com o GitHub, entre outros.

```{r echo=FALSE, out.width="50%"}
knitr::include_graphics("img/rprojs.png")
```

]


---
class: livecoding

### Criando um projeto

- Criando um projeto em uma nova pasta:

  - File > New Project > New Directory > New Project
  
  - D√™ um nome para seu projeto (ser√° o nome da pasta), escolha a pasta no seu computador, e clique em `Create Project`.
  
  
---
class:  teoria

### Diret√≥rio de trabalho/Working Directory

- O diret√≥rio de trabalho √© a pasta em que o R ir√°:
  - procurar arquivos na hora de ler informa√ß√µes;
  - gravar arquivos na hora de salvar objetos.


- Quando usamos Projetos do RStudio, o nosso diret√≥rio de trabalho √© a pasta principal do projeto. 

- A fun√ß√£o `getwd()` serve para conferir o diret√≥rio de trabalho: 

```r
> getwd()
[1] "/Users/beatrizmilz/GitHub/2022-curso-de-verao-ime-usp-relatorios"
```

- A fun√ß√£o `setwd()` serve para alterar o diret√≥rio de trabalho. **N√ÉO √â RECOMENDADO O USO! Isso torna o c√≥digo n√£o reprodut√≠vel.**

  
---
class:  teoria

### Caminhos

- Caminhos s√£o textos que representam o endere√ßo do arquivo no computador. 

- √â muito importante entender como funcionam! Caso contr√°rio, ficar√° dif√≠cil fazer coisas como importar dados para o R.

- Caminhos podem ser relativos ou absolutos.

- Caminhos absolutos: tem in√≠cio na pasta raiz do seu computador/usu√°rio. **N√ÉO √â RECOMENDADO O USO! Isso torna o c√≥digo n√£o reprodut√≠vel.**

- Caminhos relativos: tem in√≠cio no diret√≥rio de trabalho da sess√£o. Caso voc√™ esteja usando projetos, os caminhos relativos tem in√≠cio na pasta inicial do projeto. 


- **Utilize sempre que poss√≠vel caminhos relativos.**

---
class:  teoria

### Exemplos de caminhos

Exemplos acessando o mesmo arquivo:

- Caminho absoluto:
```
"/Users/beatrizmilz/GitHub/2022-curso-de-verao-ime-usp-relatorios/docs/slides/img/rprojs.png"
```

- Caminho relativo:
```
"docs/slides/img/rprojs.png"
```


???
O pacote `here` tamb√©m possui fun√ß√µes √∫teis para escrever caminhos: 

```{r echo=TRUE}
here::here()
```

---
class:  teoria

### Os arquivos .RData e .Rhistory 

- Em sua configura√ß√£o padr√£o, a IDE manter√° na "mem√≥ria" todos os √∫ltimos comandos executados, todos os dados utilizados e todos os objetos criados.

- Ao fechar e abrir o RStudio, essas informa√ß√µes ser√£o recarregadas na mem√≥ria como se o usu√°rio nunca tivesse sa√≠do do programa. Esse recurso √© tornado poss√≠vel pela cria√ß√£o de dois arquivos ocultos: `.RData` e `.Rhistory`.

- O primeiro abriga absolutamente todos os objetos criados por uma sess√£o R, enquanto o segundo cont√©m uma lista com os √∫ltimos comandos executados. 

- Ao reabrir o RStudio, o conte√∫do armazenados nestes arquivos ser√° carregado no ambiente de trabalho atual como se nada tivesse acontecido.

.footnote[Leia mais [neste cap√≠tulo do livro Zen do R](https://curso-r.github.io/zen-do-r/rdata-rhistory.html)]


```{r echo=FALSE, results='asis'}
ref_pacotes_curso_r()
```


---
class:  teoria


### Por que desistir do .RData e .Rhistory 

- Se todos os resultados parciais de uma an√°lise estiverem dispon√≠veis a qualquer momento, **diminui o incentivo para a escrita de c√≥digo reprodut√≠vel**

- Ao dependermos ativamente do `.Rdata`, **se acidentalmente sobrescrevemos um objeto** relevante e o c√≥digo para recri√°-lo n√£o estiver mais acess√≠vel, **n√£o haver√° nenhuma forma confi√°vel de recuper√°-lo**.

- O R trata todos os objetos guardados na mem√≥ria igualmente. Isso significa que ele tamb√©m ir√° armazenar nos arquivos ocultos todas as bases de dados da sess√£o. Assim, o `.RData` **pode ser um arquivo de m√∫ltiplos gigabytes**

```{r echo=FALSE, results='asis'}
ref_pacotes_curso_r()
```


---
class:  livecoding

### Como desabilitar .RData e .Rhistory

- Na barra superior: **Tools > Global Options...**

```{r, echo=FALSE, out.width="40%"}
knitr::include_graphics("https://curso-r.github.io/zen-do-r/static/rdata-rhistory/config.png")
```

```{r echo=FALSE, results='asis'}
ref_pacotes_curso_r()
```

---
class: exercicios

### Colocar em pr√°tica

1) Crie um projeto no RStudio para armazenar o que vamos criar durante o curso. Salve em algum lugar no seu computador que seja f√°cil de encontrar.

2) Desabilite o .RData e .Rhistory no seu RStudio

3) Execute o seguinte c√≥digo no console, verifique o resultado: `devtools::session_info()`

4) Dentro do projeto criado, crie uma pasta chamada "dados", e salve o seguinte arquivo na mesma: [clique aqui para baixar o arquivo `pinguins.csv`](https://beatrizmilz.github.io/2022-curso-de-verao-ime-usp-relatorios/dados/pinguins.csv)

Dados originais: https://allisonhorst.github.io/palmerpenguins/

Dados traduzidos para Portugu√™s: https://cienciadedatos.github.io/dados/

---
class: exercicios

### Colocar em pr√°tica: Continua√ß√£o

5) Crie um R Script, copie e cole o c√≥digo abaixo, e substitua o caminho correto para ler a base de pinguins. Aproveite que o RStudio nos ajuda a buscar caminhos: dentro das aspas, experimente clicar a tecla TAB.

```r
caminho <- "...." 
pinguins <- readr::read_csv(caminho)
```
6) Verifique no painel Environment do RStudio se a base de Pinguins foi importada corretamente.


---
class: livecoding

- Exemplo do Session Info

.smaller[
```{r echo=TRUE}
devtools::session_info()
```
]

---
class: revisao

### Revis√£o - Reprodutibilidade

- Em um c√≥digo reprodut√≠vel, devemos ser capazes de reproduzir totalmente os resultados a partir dos dados brutos, assim como outras pessoas (em computadores diferentes) tamb√©m devem ser capazes de reproduzir esses mesmos resultados a partir dos dados brutos.

- Utilizar boas pr√°ticas aumentam as chances de escrever um c√≥digo reprodut√≠vel. 
- Exemplos de boas pr√°ticas:

  - Utilizar Projetos do RStudio. Quando usamos projetos do RStudio, o diret√≥rio de trabalho ser√° a pasta principal do projeto.

  - Desabilitar o .Rhistory e .Rdata.

  - Utilizar caminhos relativos.

---
name: rmarkdown
class: middle, center, inverse

## RMarkdown

.left[
- O que vamos aprender:

  - O que √© o pacote rmarkdown?

  - Qual √© a estrutura de um arquivo rmarkdown?
  
  - O que √© Markdown?
  
  - Como adicionar conte√∫do em um arquivo rmarkdown?

  - Como gerar outros tipos de documentos?
  
  - Como adicionar par√¢metros no documento?
  


]

---
class:  teoria


### Ciclo da ci√™ncia de dados


```{r, out.width="65%"}
knitr::include_graphics("https://beatrizmilz.github.io/python-brasil-2021-reticulate/img/environmental-data-science-r4ds-general.png")
```


Fonte: Conceito do ciclo de ci√™ncia de dados apresentado por [Hadley Wickham no livro R for Data Science](https://r4ds.had.co.nz/introduction.html), ilustra√ß√£o por [Allison Horst](https://github.com/allisonhorst).

---
class:  teoria


### Pacote R Markdown

.pull-left[



- Criado e mantido pela [RStudio](https://rstudio.com/)

- Princ√≠pio: arquivos onde escrevemos textos e marcamos com `markdown`, mas tamb√©m podemos adicionar c√≥digos que s√£o executados.

- Extens√£o `.Rmd`

- Possibilita a utiliza√ß√£o de c√≥digos `R`, `Python`, `Markdown`, `HTML`, `CSS`, `SQL`, e outros em um √∫nico arquivo.

]

.pull-right[
```{r, out.width="70%", fig.cap="<center><b>Logo: <a href='https://rmarkdown.rstudio.com'>Pacote rmarkdown</a></b></center>"}
knitr::include_graphics("https://beatrizmilz.github.io/python-brasil-2021-reticulate/img/hex-rmarkdown.png")
```
]

---
class:  teoria


### Pacote R Markdown


.pull-left[
- A reprodutibilidade √© algo importante para o R Markdown.

-  A comunidade de R, e a equipe da RStudio, desenvolveram outros pacotes que integram bem com R Markdown para  gerar diversos produtos de an√°lise de dados diferentes, com arquivos .Rmd. 

]

.pull-right[
```{r, out.width="70%", fig.cap="<center><b>Fonte: <a href='https://rmarkdown.rstudio.com'>Pacote `rmarkdown`</a></b></center>"}
knitr::include_graphics("https://beatrizmilz.github.io/slidesR/img/rmarkdown/markdown.png")
```
]


---
class:  livecoding


### Come√ßando com o R Markdown 

- **Criando um arquivo**:

  - `File > New File > R Markdown`

- **Estrutura do arquivo**: 

  - YAML - metadados do documento
  - Code chunks - Campos de c√≥digo (pode receber c√≥digo em R, SQL, Python, entre outros)
  - Textos marcados com Markdown ou HTML

- **Transformar o .Rmd no arquivo final**
  - Bot√£o Knit, ou usando o atalho: `Ctrl + Shift + K`
  - Boa pr√°tica: fa√ßa isso com frequ√™ncia. 
  
---
class: exercicios

### Colocar em pr√°tica: 
  
- Dentro do projeto do RStudio criado, crie um novo arquivo RMarkdown que gera um HTML. 

- O arquivo j√° vem com alguns conte√∫dos para servir de exemplo. Observe a estrutura deste arquivo! Tente imaginar o que ser√° gerado.

- Aperte o bot√£o `knit` para gerar o resultado final. Veja o resultado: √© o que voc√™ imaginou?

- Fa√ßa pequenas altera√ß√µes e aperte o bot√£o `knit` novamente, para ver como ficou. Sugest√µes:
  - Altere o t√≠tulo, adicione seu nome, mude a data.
  - Escreva algo diferente no corpo do arquivo.
  

---
class:  teoria


### Markdown

- O RMarkdown possibilita a utiliza√ß√£o da linguagem de marca√ß√£o simples Markdown. Essa linguagem de marca√ß√£o foi elaborada para ser f√°cil de ler e  f√°cil de escrever.

* Confira as cheatsheets: [`rmarkdown` Cheatsheet 2.0](http://www.rstudio.com/wp-content/uploads/2016/03/rmarkdown-cheatsheet-2.0.pdf) e [`rmarkdown` Cheatsheet](https://www.rstudio.com/wp-content/uploads/2015/02/rmarkdown-cheatsheet.pdf).


- O RStudio Visual Editor facilita o uso do Markdown no RStudio.

---
class: livecoding

### Markdown

.pull-left[
- Negrito, it√°lico, tachado

- Criar t√≠tulos

- Listas
  - Enumerada
  - N√£o enumerada
]

.pull-right[
- Marcar como c√≥digo

- Marcar como cita√ß√£o

- Links

- Imagens
]


---
class:  teoria

### Chunks de C√≥digo em R

- Os chunks s√£o campos onde podemos inserir c√≥digo de R (ou Python, SQL,  Bash...) em um arquivo RMarkdown. 

- Existe um atalho do teclado para criar chunks no RStudio:  `Ctrl + ALt + I`. 

- Tamb√©m √© poss√≠vel criar um chunk clicando no seguinte bot√£o do RStudio:


```{r echo=FALSE, out.width="90%"}
knitr::include_graphics("img/create-chunk.png")
```

---

class:  teoria

#### Exemplo:


```{r echo=TRUE}
summary(dplyr::starwars[1:4])
```

---
class:  teoria

#### Exemplo:

.left-code[
```{r plot-exemplo-ggplot2, echo=TRUE, fig.show="hide", out.width="95%", echo=TRUE}
library(ggplot2)
ggplot(mtcars) +
  aes(x = hp,
      y = mpg,
      colour = cyl) +
  geom_point(size = 2L)
```
]

.right-plot[
![](`r knitr::fig_chunk("plot-exemplo-ggplot2", "png")`)
]


---
class:  teoria

### Op√ß√µes de Chunk

- H√° uma variedade de op√ß√µes de chunk que podem afetar como os chunks de c√≥digo s√£o compilados. Exemplos: 

- `echo=FALSE`- evita que o pr√≥prio c√≥digo apare√ßa

- `eval=FALSE` - mostra o c√≥digo, mas ele n√£o √© executado

- `warning=FALSE` e `message=FALSE` - oculta mensagens de avisos produzidas

- `out.width` - controla o a largura das figuras, gr√°ficos, tabelas geradas (Ex: out.width = "100%")

- Ex de configura√ß√£o do chunk: `{r, warning=FALSE, message=FALSE}`


---
class:  teoria

### C√≥digos em R - Op√ß√µes de chunk

.pull-left[
#### C√≥digo + Resultado
- `echo=TRUE`
```{r echo=TRUE}
nrow(mtcars)
```
]

.pull-right[

#### Apenas c√≥digo
- `echo=TRUE, eval=FALSE`
```{r echo=TRUE, eval=FALSE}
nrow(mtcars)
```

#### Apenas resultado
- `echo=FALSE`
```{r echo=FALSE}
nrow(mtcars)
```

]


---
class:  teoria

### C√≥digo inline

- √â √∫til para adicionar resultados de c√≥digo em R dentro de par√°grafos.


**Exemplo:**

A base mtcars possui `r nrow(mtcars)` carros.
As colunas presentes na base s√£o 
`r knitr::combine_words(names(mtcars), and = "e ")`.

**C√≥digo Markdown:**


```{r eval=FALSE, echo=TRUE}
A base mtcars possui `r nrow(mtcars)` carros.
As colunas presentes na base s√£o 
`r knitr::combine_words(names(mtcars), and = "e ")`.
```




---
class:  teoria

### Op√ß√µes globais de Chunk

As op√ß√µes globais de chunk s√£o op√ß√µes de chunk que s√£o v√°lidas para o documento inteiro. Algumas op√ß√µes s√£o √∫teis, como `fig.align = "center"`.
Para configurar as op√ß√µes globais de chunk, modifique o c√≥digo abaixo e insira ap√≥s o c√≥digo `YAML` (retire os `#` no in√≠cio de cada linha):

- Ex:
  - Configura√ß√µes do chunk:
`{r setup, include=FALSE}`
  - Conte√∫do do chunk:
`knitr::opts_chunk$set(...)`



---
class:  teoria

### Adicionando imagens usando o knitr

.pull-left[
- Fun√ß√£o: `knitr::include_graphics()`

-  Op√ß√µes de Chunk: 

  - `out.width = "30%"` - Largura da imagem

  - `fig.align = 'center'`  - Alinhamento da imagem

  - `fig.cap="Logo R"` - Legenda da imagem 
]

.pull-right[

Exemplo:


```{r  out.width = "30%", fig.align = 'center', fig.cap="Logo R"}
knitr::include_graphics("https://www.r-project.org/Rlogo.png")
```

Sugest√£o de leitura: [Op√ß√µes do knitr](https://yihui.name/knitr/options/#chunk-options)


]


---
class:  teoria

### Tabelas com R

```{r echo=TRUE}
knitr::kable(x = head(dplyr::starwars[1:6]), format = "html")
```

- Outra op√ß√£o:  `DT::datatable(dplyr::starwars)`  



---
class:  teoria

### Erros!

- Boa pr√°tica: compilar com frequ√™ncia. 

- √â bem comum dar erro ao compilar o arquivo pois **qualquer** c√≥digo errado causa isso. Algumas coisas pra se observar:

  - **YAML header** - se algo estiver errado, vai dar erro ao compilar. 
Muito cuidado com a identa√ß√£o!

  - **C√≥digo nos chunks** - teste o _Run All Chunks_ e veja se aparece erro em algum chunk espec√≠fico.
Se descobrir, tente verificar o que h√° de errado no c√≥digo (pode ser a falta de um par√™nteses, v√≠rgula, entre outros).

  - Todos os objetos e pacotes usados no seu script precisam estar dispon√≠veis no seu `.Rmd`. Verifique isso :)

---
class: livecoding

### Gerando outros tipos de arquivos

- Alterando o output no YAML. Ex:

  - Word: `output: word_document`

  - HTML: `output: html_document`  
  
- Gerando PDFs a partir de HTML:

  - Usando a fun√ß√£o `pagedown::chrome_print("caminho/ate/arquivo.html")`
  
  - Adicionando a linha no YAML: 
  `knit: pagedown::chrome_print`
  
---
class: livecoding

### Templates de R Markdown

.pull-left[

  -  Pacotes tamb√©m oferecem templates (`File > New File > R Markdown > From template`).
  
  - Os templates dispon√≠veis dependem dos pacotes instalados.
  
]

.pull-right[  
```{r, out.width="90%"}
knitr::include_graphics("img/rmd-from-template.png")
```
]

---
class: teoria
### Exemplos

.small[
```{r echo=FALSE}
exemplos_rmd <- tibble::tibble(pacote = as.character(),
               desc = as.character(),
               exemplos = as.character()) |> 
  
  tibble::add_row(pacote = "[blogdown](https://bookdown.org/yihui/blogdown/)",
                  desc = "Blogs e sites",
                  exemplos = "- [Site da Curso-R](https://curso-r.com/) <br> - [Site da Associa√ß√£o Brasileira de Jurimetria (ABJ)](https://abj.org.br/)") |> 
  
  tibble::add_row(pacote = "[distill](https://rstudio.github.io/distill/)",
                  desc = "Blogs e sites",
                  exemplos = "- [RStudio AI Blog](https://blogs.rstudio.com/ai/) <br> - [Laborat√≥rio da Associa√ß√£o Brasileira de Jurimetria (ABJ)](https://lab.abj.org.br/)") |> 
  
  tibble::add_row(pacote = "[bookdown](https://bookdown.org/)",
                  desc = "Livros",
                  exemplos = "- [Livro Ci√™ncia de Dados em R](https://livro.curso-r.com/) <br> - [R for Data Science](https://r4ds.had.co.nz/)") |> 
  
  tibble::add_row(pacote = "[xaringan](https://github.com/yihui/xaringan)",
                  desc = "Apresenta√ß√µes",
                  exemplos = "- Essa apresenta√ß√£o <br> - [Build Your Own Universe - Garrick Aden-Buie & Travis Gerke](https://www.garrickadenbuie.com/talk/build-your-own-universe/)") |> 
  
  tibble::add_row(pacote = "[pagedown](https://github.com/rstudio/pagedown)",
                  desc = "Curr√≠culos, cartas e trabalhos acad√™micos",
                  exemplos = "- [Relat√≥rio do Observat√≥rio da Insolv√™ncia](https://abjur.github.io/obsFase2/relatorio/obs_recuperacoes_abj.pdf) <br>  - [Meu curr√≠culo](https://beatrizmilz.github.io/resume/index.html) ") |> 


  tibble::add_row(pacote = "[learnr](https://rstudio.github.io/learnr/)",
                  desc = "Tutoriais interativos",
                  exemplos = "- [Text mining with tidy data principles](https://juliasilge.shinyapps.io/learntidytext/) <br> - [Teacups, Giraffes,  & Statistics](https://tinystats.github.io/teacups-giraffes-and-statistics/)") |> 
  
  tibble::add_row(pacote = "[rticles](https://github.com/rstudio/rticles)",
                  desc = "Artigos cient√≠ficos",
                  exemplos = "   ") |>  
  tibble::add_row(pacote = " ",
                  desc = "Outros exemplos",
                  exemplos = "[Newsletter Garimpo](https://nucleo.jor.br/newsletters/garimpo)") 
  


exemplos_rmd |> 
  dplyr::slice(1:6) |>  
  knitr::kable(col.names = c("Pacote", "O que podemos fazer?", "Exemplos"))
```
]

```{r echo=FALSE, results='asis'}
ref_relatorios_curso_r()
```


---
class: teoria

### Par√¢metros


.pull-left[

Devemos adicionar os par√¢metros (e algum valor padr√£o) no YAML. 

Ex:


```
---
title: "Relat√≥rio com Par√¢mentros"
author: "Beatriz"
date: "Fevereiro de 2022"
output: html_document
params:
  mes: 12
  ano: 2021
---
```
]


.pull-right[

Para acessar os par√¢metros, usamos: `params$nome_parametro`.

Ex: `params$mes` para acessar o m√™s, ou `params$ano`.


Recomenda√ß√£o de leitura: [R Markdown: The Definitive Guide - Chapter 15 Parameterized reports](https://bookdown.org/yihui/rmarkdown/parameterized-reports.html)

]


---
class: teoria

### Extra: Adicionar equa√ß√µes
  
- Equa√ß√£o centralizada: Envolver a equa√ß√£o por dois `$`.

$${\text{M√©dia}=\frac {a_{1}+a_{2}+\cdots +a_{n}}{n}}$$

  - Equa√ß√£o junto ao texto: Envolver a equa√ß√£o por um `$`.

> Ou tamb√©m na linha ${\text{M√©dia}=\frac {a_{1}+a_{2}+\cdots +a_{n}}{n}}$, junto ao texto!

**C√≥digo Markdown:**


```md
$${\text{M√©dia}=\frac {a_{1}+a_{2}+\cdots +a_{n}}{n}}$$
```

.small[Dica: [Equa√ß√µes em LaTeX no Mettzer](https://app.mettzer.com/latex), ou pesquise no google por "Equa√ß√µes em LaTeX".]

---
class: teoria

### Extra: Adicionar refer√™ncias

TO DO!

- https://www.zotero.org/

- https://retorque.re/zotero-better-bibtex/installation/


---
class: revisao

### Revis√£o - R Markdown

- ....


- ....

- ....


---
name: git-e-github
class: middle, center, inverse


## Git e GitHub

.left[
- O que vamos aprender:

  - O que √© controle de vers√£o de arquivos?
  
  - O que √© Git? O que √© GitHub?
  
  - Como configurar de forma que possamos usar o Git e GitHub diretamente do RStudio?
  
  - Como disponibilizar um documento que fiz em RMarkdown na internet, usando o GitHub?

]


---
class: teoria

### Git

- Git √© um **sistema de versionamento**, criado por Linus Torvalds, autor do Linux.

- √â capaz de guardar o hist√≥rico de altera√ß√µes de todos os arquivos dentro de uma pasta, que chamamos de reposit√≥rio.

- Funciona como o "*Track changes*" do word, mas muito melhor.

- Torna-se importante √† medida que seu trabalho √© __colaborativo__.

- Git √© um software que voc√™ instala no computador.

```{r echo=FALSE, out.width="30%", fig.align='center'}
knitr::include_graphics("img/git.png")
```


```{r echo=FALSE, results='asis'}
ref_pacotes_curso_r()
```


---
class: teoria

### GitHub

- GitHub √© um site onde voc√™ coloca e compartilha reposit√≥rios Git.

- Utilizado por milh√µes de pessoas em projetos de c√≥digo aberto ou fechado.

- √ötil para colaborar com outros programadores em projetos de ci√™ncia de dados.

- Existem alternativas, como [GitLab](https://about.gitlab.com/) e [BitBucket](https://bitbucket.org/product).

- GitHub √© um site que voc√™ acessa na internet.

<br>

```{r echo=FALSE, out.width="30%", fig.align='center'}
knitr::include_graphics("img/github.png")
```

```{r echo=FALSE, results='asis'}
ref_pacotes_curso_r()
```

---

class: teoria


### Configurando o Git e GitHub no RStudio



####  Usando protocolo https

- `r emo::ji("white_large_square")` Ter o pacote `usethis` instalado 

- `r emo::ji("white_large_square")` Se apresentar para o `git` 

- `r emo::ji("white_large_square")` Criar um GitHub Token/PAT

- `r emo::ji("white_large_square")` Armazenar o GitHub Token/PAT 

- `r emo::ji("white_large_square")` Reiniciar o RStudio


```{r echo=FALSE, results='asis'}
ref_pacotes_curso_r()
```



---

class: teoria

### Configurando o Git e GitHub no RStudio


#### Usando protocolo ssh

- `r emo::ji("white_large_square")` Todas as etapas para o protocolo https (listadas no slide anterior)

- `r emo::ji("white_large_square")` Criar as chaves SSH no RStudio

- `r emo::ji("white_large_square")` Adicionar a chave ssh no ssh-agent

- `r emo::ji("white_large_square")` Adicionar as chaves p√∫blicas no  GitHub

- `r emo::ji("white_large_square")` Alterar o protocolo padr√£o no arquivo `.Rprofile`

- `r emo::ji("white_large_square")` Reiniciar o RStudio



Obs: Se voc√™ utiliza Linux, recomendamos usar `ssh`.



```{r echo=FALSE, results='asis'}
ref_pacotes_curso_r()
```


---

class: teoria

### Configure seu usu√°rio do Git

Antes de come√ßarmos a versionar o c√≥digo do nosso projeto, vamos configurar o Git e o GitHub no RStudio. 

Esse processo precisa ser feito apenas uma vez!

```
usethis::use_git_config(
  user.name = "SEU NOME NO GITHUB",
  user.email = "seu_email_no@github.com"
)
```

- Em `user.name`, pode ser seu nome mesmo, n√£o precisa ser o nickname.

- O `user.email` precisa ser o que est√° vinculado √† sua conta do GitHub.

---

class: teoria

### Configure o Personal Access Token 

- Ao conectar com o GitHub, voc√™ ser√° instru√≠da(o) a criar um *Personal Access Token* (PAT).

- O PAT serve para autenticar ao GitHub, podendo ser utilizado como senha de acesso ou internamente para automatizar tarefas (como criar um reposit√≥rio).

- Para criar um novo PAT, use a fun√ß√£o `usethis::create_github_token()`. Uma janela do navegador ser√° aberta, e voc√™ deve autenticar no GitHub (se necess√°rio), criar o novo token, e copi√°-lo. 

```{r echo=TRUE, eval=FALSE}
usethis::create_github_token()
```


```{r echo=FALSE, results='asis'}
ref_pacotes_curso_r()
```


---

class: teoria

### Armazenar o Personal Access Token 

#### M√©todo 1 - `gitcreds::gitcreds_set()`


.pull-left[
```{r echo=TRUE, eval=FALSE}
gitcreds::gitcreds_set()
# -> Your current credentials for 'https://github.com':
#   protocol: https
#   host    : github.com
#   username: beatrizmilz
#   password: <-- hidden -->
#     
# -> What would you like to do? 
# 1: Keep these credentials
# 2: Replace these credentials
# 3: See the password / token
```
]


.pull-right[
Siga as instru√ß√µes e cole o PAT quando for solicitado as credenciais.

```{r echo=TRUE, eval=FALSE}
# -> Adding new credentials...
# -> Removing credetials from cache...
# -> Done.
```
]



```{r echo=FALSE, results='asis'}
ref_pacotes_curso_r()
```



---

class: teoria

#### M√©todo 2 - Armazenar manualmente no `.Renviron`

- Use a fun√ß√£o `usethis::edit_r_environ()` para abrir o arquivo `.Renviron` para salvar seu token. 

```{r echo=TRUE, eval=FALSE}
usethis::edit_r_environ()
# ‚óè Modify 'C:/Users/beatr/Documents/.Renviron'
# ‚óè Restart R for changes to take effect
```

- Crie uma nova linha na forma `GITHUB_PAT=SEU_TOKEN`, adicione o token, **pule uma linha** e salve o arquivo. Se certifique que o arquivo termina com uma linha vazia!


Use essa estrutura, substituindo os 0 pelo c√≥digo copiado na etapa anterior:

```{r echo=TRUE, eval=FALSE}
GITHUB_PAT="0000000000000000000000000000000000000000"
```



```{r echo=FALSE, results='asis'}
ref_pacotes_curso_r()
```


---

class: teoria

### Git Situation Report

- Utilize a fun√ß√£o `usethis::git_sitrep()` e leia o resultado que aparece no console. A mensagem abaixo foi cortada para mostrar os trechos de interesse!


```r
usethis::git_sitrep()
#> Git config (global)
#> ‚óè Name: 'SEU NOME DEVE APARECER AQUI'
#> ‚óè Email: 'SEU EMAIL DEVE APARECER AQUI'

#> GitHub
#> ‚óè Default GitHub host: 'https://github.com'
#> ‚óè Personal access token for 'https://github.com': '<discovered>' ***IMPORTANTE ESTAR COMO DISCOVERED***
#> ‚óè GitHub user: 'SEU NOME DE USU√ÅRIO(A) DEVE APARECER AQUI'
#> ‚óè Token scopes: 'gist, repo, user, workflow'
#> ‚óè Email(s): 'SEU EMAIL DEVE APARECER AQUI'
```

```{r echo=FALSE, results='asis'}
ref_pacotes_curso_r()
```


---

class: teoria

### Configurando com o SSH (Parte 1)



.pull-left[

- Se voc√™ utiliza Linux, recomendamos usar o protocolo `ssh`.

- Al√©m das etapas anteriores (se apresentar para o `git` e configurar o PAT), √© necess√°rio seguir os seguintes passos: 

** CRIANDO UMA CHAVE SSH**

- No RStudio, clique em `Tools` -> `Global Options...` -> `Git/SVN`. No campo `SSH RSA Key`, clique em `Create RSA Key`.



Refer√™ncia: https://happygitwithr.com/ssh-keys.html 

]

.pull-right[

```{r echo=FALSE, fig.align='center', out.width="90%"}
knitr::include_graphics("img/ssh/etapa-1.png")
```

]




```{r echo=FALSE, results='asis'}
ref_pacotes_curso_r()
```


---

class: teoria

### Configurando com o SSH (Parte 2)


.pull-left[

** CRIANDO UMA CHAVE SSH**

- N√£o altere o primeiro campo, mas voc√™ pode adicionar uma senha caso queira. Por√©m voc√™ precisar√° informar essa senha todas as vezes que quiser fazer algumas a√ß√µes como Pull ou Push. Clique em `Create`.

A sua senha ser√° criada e aparecer√° uma caixinha com ela. Pode clicar em `Close`.

Ap√≥s fechar, veja se o campo `SSA RSA KEY` est√° preenchido.

Refer√™ncia: https://happygitwithr.com/ssh-keys.html 

]

.pull-right[


```{r echo=FALSE, fig.align='center', out.width="90%"}
knitr::include_graphics("img/ssh/etapa-2.png")
```

]

```{r echo=FALSE, results='asis'}
ref_pacotes_curso_r()
```



---


class: teoria

### Configurando com o SSH (Parte 3)


.pull-left[

**Verificando se o ssh-agent est√° funcionando**





Refer√™ncia: https://happygitwithr.com/ssh-keys.html#add-key-to-ssh-agent

]

.pull-right[

- **Mac OS ou Linux** - no terminal, escreva:

```
eval "$(ssh-agent -s)"
```


- **Windows** - no Git Bash shell, escreva:

```
eval $(ssh-agent -s)
```



<br><br><br><br>
A resposta esperada, nessa etapa, √© algo como:
```
Agent pid 14198
```


]


```{r echo=FALSE, results='asis'}
ref_pacotes_curso_r()
```



---


class: teoria

### Configurando com o SSH (Parte 4)


.pull-left[

**Adicionando a chave ssh no ssh-agent**

- Se voc√™ definiu uma senha ao criar a chave ssh, ela ser√° solicitada nessa etapa.


- **Linux** - no terminal, escreva:

```
ssh-add ~/.ssh/id_rsa
```


- **Mac OS** - no terminal, escreva:

```
ssh-add -K ~/.ssh/id_rsa
```


- **Windows** - no Git Bash shell, escreva:

```
ssh-add ~/.ssh/id_rsa
```
<br>

Refer√™ncia: https://happygitwithr.com/ssh-keys.html#add-key-to-ssh-agent

]

.pull-right[

A resposta esperada, nessa etapa, √© algo como:
```
Identity added: /home/bea/.ssh/id_rsa
```

```{r echo=FALSE, fig.align='center', out.width="100%"}
knitr::include_graphics("img/ssh/etapa-5.png")
```

]


```{r echo=FALSE, results='asis'}
ref_pacotes_curso_r()
```



---


class: teoria

### Configurando com o SSH (Parte 5)



**Adicionando a chave p√∫blica no GitHub**

- No GitHub, v√° em `Settings` -> `SSH and GPG keys` -> `New ssh key` (ou clique aqui: https://github.com/settings/ssh/new )  


- No RStudio, clique em `Tools` -> `Global Options...` -> `Git/SVN`. No campo `SSH RSA Key`, clique em `View Public Key`.

- Uma janela vai abrir com a chave p√∫blica e voc√™ deve copiar o conte√∫do todo.

- No campo `Title`, escreva algo que ajude voc√™ a lembrar em qual computador essa chave est√° sendo usada. No campo `Key`, cole todo o conte√∫do copiado na etapa anterior. Clique em `Add SSH key`.



<br>

Refer√™ncia: https://happygitwithr.com/ssh-keys.html#add-key-to-ssh-agent


```{r echo=FALSE, results='asis'}
ref_pacotes_curso_r()
```



---


class: teoria

### Configurando com o SSH (Parte 6)



**Dicas**


- Confira se est√° funcionando executando o seguinte c√≥digo na aba Terminal, no RStudio: 
```
ssh -T git@github.com
```

- Ao clonar um projeto, √© importante utilizar o protocolo que foi configurado. O protocolo padr√£o utilizado pelo usethis √© o `https`. Para alterar para o `ssh` , altere no `.Rprofile` o protocolo padr√£o a ser utilizado: 

  - Abrir o arquivo o `.Rprofile`: 
  
```
usethis::edit_r_profile()
```

  - Adicione a seguinte linha neste arquivo:
  
```
options(usethis.protocol = "ssh")
```

  - Salve o arquivo e reinicie o RStudio.


<br>

Refer√™ncia: https://usethis.r-lib.org/reference/git_protocol.html

```{r echo=FALSE, results='asis'}
ref_pacotes_curso_r()
```


---

class: teoria

### Versione com o Git e o GitHub

```{r, eval=FALSE}
usethis::use_git()
```

- Rodando o comando acima na pasta do projeto (a nova aba do RStudio que
apareceu) voc√™ adiciona controle de vers√£o.

- Voc√™ receber√° algumas instru√ß√µes para seguir, mas est√° tudo certo.

```{r, eval=FALSE}
usethis::use_github()
```

- O comando acima sincroniza a pasta com o GitHub.

- Mais uma vez, voc√™ receber√° algumas instru√ß√µes, mas lembre-se  de alterar para o protocolo `ssh` caso tenha feito a configura√ß√£o usando esse protocolo. Para isso, use o argumento `protocol = ssh`.

```{r echo=FALSE, results='asis'}
ref_pacotes_curso_r()
```


---

class: teoria

### Resumo

1. Reposit√≥rio: Criar projeto/pacote

2. Adicionar Git

3. Adicionar GitHub

4. Commit: Edite e "Commite" as mudan√ßas no c√≥digo

5. Push: Suba os commits para o GitHub

6. Pull (extra): Baixe o estado atual do projeto

### Cuidados

- Se uma base de dados tem mais do que 50Mb de tamanho, ela n√£o deveria estar no seu reposit√≥rio.

- Nem sempre o comando Pull d√° certo. √Äs vezes, voc√™ e a colega de trabalho fizeram mudan√ßas no mesmo arquivo e, quando v√£o juntar, ocorre um conflito.

```{r echo=FALSE, results='asis'}
ref_pacotes_curso_r()
```


---
class: revisao

### Revis√£o - Git e GitHub

- ....


- ....

- ....


---
class: center

## Agradecemos a aten√ß√£o!


Lembre-se de enviar as d√∫vidas no [discourse da Curso-R](https://discourse.curso-r.com/)!

Slides criados usando os pacotes em R  üì¶ :

[**xaringan**](https://github.com/yihui/xaringan)<br>
[gadenbuie/xaringanthemer](https://github.com/gadenbuie/xaringanthemer)

O chakra vem da biblioteca javascript [remark.js](https://remarkjs.com), e os pacotes  [**knitr**](http://yihui.name/knitr), e [R Markdown](https://rmarkdown.rstudio.com).


<!-- inicio font awesome -->
<script src="https://kit.fontawesome.com/1f72d6921a.js" crossorigin="anonymous"></script>

<!-- final font awesome -->
